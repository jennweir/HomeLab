kind: ArgoCD
apiVersion: argoproj.io/v1beta1
metadata:
  name: argocd
  namespace: argocd
spec:
  controller:
    resources:
      limits:
        cpu: 400m
        memory: 2048Mi
      requests:
        cpu: 200m
        memory: 1024Mi
  ha:
    enabled: false
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 250m
        memory: 128Mi
  redis:
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
  repo:
    resources:
      limits:
        cpu: 200m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    serviceaccount: argocd-argocd-repo-server
    mountsatoken: true
    sidecarContainers:
      - name: avp-kustomize
        image: quay.io/jennweir/argocd-sidecar-avp:0.0.4@sha256:dd17cf54325d8fc95f4a51bb06c116fc2b56b6912d7cf0ff3537505e9633f8ae
        command:
          - /var/run/argocd/argocd-cmp-server
        env:
          - name: AVP_TYPE
            value: gcpsecretmanager
          - name: GOOGLE_APPLICATION_CREDENTIALS
            value: /var/run/secret/google/credentials.json
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        volumeMounts:
          - mountPath: /var/run/secret/google
            name: google-creds
            readOnly: true
          - mountPath: /var/run/secrets/openshift/serviceaccount
            name: bound-sa-token
            readOnly: true
          - mountPath: /var/run/argocd
            name: var-files
          - mountPath: /home/argocd/cmp-server/plugins
            name: plugins
          - mountPath: /home/argocd/cmp-server/config/plugin.yaml
            subPath: avp-kustomize.yaml
            name: cmp-plugin
          - mountPath: /tmp
            name: tmp
    volumes:
      - name: google-creds
        configMap:
          name: google-creds
          defaultMode: 420
      - name: bound-sa-token
        projected:
          sources:
            - serviceAccountToken:
                audience: openshift
                expirationSeconds: 3600
                path: token
      - configMap:
          name: cmp-plugin
        name: cmp-plugin
  server:
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 125m
        memory: 128Mi
    route:
      enabled: true
  # sso:
  #   dex:
  #     resources:
  #       limits:
  #         cpu: 500m
  #         memory: 256Mi
  #       requests:
  #         cpu: 250m
  #         memory: 128Mi
  #   provider: dex
